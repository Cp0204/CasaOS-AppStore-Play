name: teslamate
services:
  teslamate:
    image: teslamate/teslamate:latest
    restart: unless-stopped
    environment:
      - ENCRYPTION_KEY=secretkey #replace with a secure key to encrypt your Tesla API tokens
      - DATABASE_USER=teslamate
      - DATABASE_PASS=teslamate #insert your secure database password!
      - DATABASE_NAME=teslamate
      - DATABASE_HOST=database
      - MQTT_HOST=mosquitto
    ports:
      - published: "4000"
        target: 4000
        protocol: tcp
    volumes:
      - type: bind
        source: /DATA/AppData/teslamate/import
        target: /opt/app/import
    cap_drop:
      - all
    container_name: teslamate
    deploy:
      resources:
        reservations:
          memory: 1024M
    networks:
      - teslamate

  database:
    image: postgres:16
    restart: unless-stopped
    environment:
      - POSTGRES_USER=teslamate
      - POSTGRES_PASSWORD=password #insert your secure database password!
      - POSTGRES_DB=teslamate
    volumes:
      - type: bind
        source: /DATA/AppData/teslamate/db
        target: /var/lib/postgresql/data
    container_name: teslamate-db
    networks:
      - teslamate

  grafana:
    image: teslamate/grafana:latest
    restart: unless-stopped
    environment:
      - DATABASE_USER=teslamate
      - DATABASE_PASS=teslamate #insert your secure database password!
      - DATABASE_NAME=teslamate
      - DATABASE_HOST=database
    ports:
      - published: "3001"
        target: 3000
        protocol: tcp
    volumes:
      - type: bind
        source: /DATA/AppData/teslamate/grafana-data
        target: /var/lib/grafana
    container_name: teslamate-grafana
    networks:
      - teslamate

  mosquitto:
    image: eclipse-mosquitto:2
    restart: unless-stopped
    command: mosquitto -c /mosquitto-no-auth.conf
    # ports:
    #   - published: "1883"
    #     target: 1883
    #     protocol: tcp
    volumes:
      - type: bind
        source: /DATA/AppData/teslamate/mosquitto/conf
        target: /mosquitto/config
      - type: bind
        source: /DATA/AppData/teslamate/mosquitto/data
        target: /mosquitto/data
    container_name: teslamate-mosquitto
    networks:
      - teslamate

networks:
  teslamate:
    name: teslamate

x-casaos:
  architectures:
    - arm
    - arm64
    - amd64
  main: teslamate
  store_app_id: teslamate
  author: Cp0204
  category: Utilities
  description:
    en_us: A self-hosted data logger for your Tesla ğŸš˜. A powerful, self-hosted data logger for your Tesla. Written in Elixir. Data is stored in a Postgres database. Visualization and data analysis with Grafana. Vehicle data is published to a local MQTT Broker.
    zh_cn: ç‰¹æ–¯æ‹‰æ±½è½¦çš„è‡ªæ‰˜ç®¡æ•°æ®è®°å½•å™¨ ğŸš˜ã€‚ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„ç‰¹æ–¯æ‹‰è‡ªæ‰˜ç®¡æ•°æ®è®°å½•å™¨ã€‚ä½¿ç”¨ Elixir ç¼–å†™ã€‚æ•°æ®å­˜å‚¨åœ¨ Postgres æ•°æ®åº“ä¸­ã€‚ä½¿ç”¨ Grafana è¿›è¡Œå¯è§†åŒ–å’Œæ•°æ®åˆ†æã€‚è½¦è¾†æ•°æ®å‘å¸ƒåˆ°æœ¬åœ° MQTT ä»£ç†ã€‚
  developer: teslamate
  icon: https://cdn.jsdelivr.net/gh/Cp0204/CasaOS-AppStore-Play@main/Apps/teslamate/icon.svg
  screenshot_link:
    - https://cdn.jsdelivr.net/gh/Cp0204/CasaOS-AppStore-Play@main/Apps/teslamate/screenshot-1.png
    - https://cdn.jsdelivr.net/gh/Cp0204/CasaOS-AppStore-Play@main/Apps/teslamate/screenshot-2.png
    - https://cdn.jsdelivr.net/gh/Cp0204/CasaOS-AppStore-Play@main/Apps/teslamate/screenshot-3.png
  tagline:
    en_us: A self-hosted data logger for your Tesla
    zh_cn: ç‰¹æ–¯æ‹‰æ±½è½¦çš„è‡ªæ‰˜ç®¡æ•°æ®è®°å½•å™¨
  thumbnail: https://cdn.jsdelivr.net/gh/Cp0204/CasaOS-AppStore-Play@main/Apps/teslamate/thumbnail.png
  tips:
    before_install:
      en_us: |
        ## Instructions

        1. **Choose a secure encryption key** that will be used to encrypt your Tesla API tokens (insert as `ENCRYPTION_KEY`).
        2. **Choose your secure database password** and insert it at every occurrence of `DATABASE_PASS` and `POSTGRES_PASSWORD`

        ## Usage

        1. Open the web interface [http://your-ip-address:4000](http://localhost:4000)
        2. Sign in with your Tesla Account
        3. The Grafana dashboards are available at [http://your-ip-address:3000](http://localhost:3000). Log in with the default user `admin` (initial password `admin`) and enter a secure password.
      zh_cn: |
        ## è¯´æ˜

        1.  **é€‰æ‹©ä¸€ä¸ªå®‰å…¨çš„åŠ å¯†å¯†é’¥** æ¥åŠ å¯†æ‚¨çš„ Tesla API ä»¤ç‰Œï¼ˆå°†å…¶è®¾ä¸º `ENCRYPTION_KEY`ï¼‰ã€‚
        2.  **é€‰æ‹©æ‚¨çš„å®‰å…¨æ•°æ®åº“å¯†ç ** å¹¶å°†å…¶è®¾ä¸º `DATABASE_PASS` å’Œ `POSTGRES_PASSWORD`ã€‚

        ## ä½¿ç”¨æ–¹æ³•

        1.  æ‰“å¼€ç½‘é¡µç•Œé¢ [http://your-ip-address:4000](http://your-ip-address:4000)
        2.  ä½¿ç”¨æ‚¨çš„ Tesla è´¦æˆ·ç™»å½•
        3.  Grafana ä»ªè¡¨æ¿ä½äº [http://your-ip-address:3000](http://your-ip-address:3000)ã€‚ä½¿ç”¨é»˜è®¤ç”¨æˆ· `admin`ï¼ˆåˆå§‹å¯†ç  `admin`ï¼‰ç™»å½•å¹¶è¾“å…¥å®‰å…¨å¯†ç ã€‚
  title:
    en_us: TeslaMate
  index: /
  port_map: "4000"
